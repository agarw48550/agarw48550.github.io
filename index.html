<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ayaan Agarwal - Tech & Engineering Portfolio</title>
    
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Load Inter Font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- Icon library for Command Palette & Admin -->
    <script src="https://unpkg.com/lucide-react@0.294.0/dist/umd/lucide.min.js"></script>
    
    <style>
        /* Base styling */
        body {
            font-family: 'Inter', sans-serif;
            @apply bg-white dark:bg-gray-900 text-gray-900 dark:text-gray-100;
            cursor: none;
            overflow-x: hidden;
        }
        * { cursor: none; }
        
        /* Interactive Canvas Background */
        #interactive-canvas {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 1;
            background-color: #111827;
            @apply dark:opacity-100 opacity-0 transition-opacity;
        }
        .hero-content { position: relative; z-index: 2; }

        /* Typing Animation Cursor */
        .typing-cursor {
            display: inline-block; width: 10px; height: 2.5rem; @apply bg-sky-500;
            animation: blink 1s infinite; margin-left: 8px; vertical-align: bottom;
        }
        @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0; } }
        
        /* Scroll Animation Styling */
        .scroll-animate { opacity: 0; transition: opacity 0.6s ease-out, transform 0.6s ease-out; }
        .slide-in-up { transform: translateY(30px); }
        .slide-in-left { transform: translateX(-30px); }
        .slide-in-right { transform: translateX(30px); }
        .scroll-animate.is-visible { opacity: 1; transform: translateY(0) translateX(0); }

        /* Gradient text */
        .gradient-text {
            @apply bg-gradient-to-r from-sky-500 to-indigo-500;
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
        }

        /* 3D Tilt Project Card Effect */
        .project-card {
            @apply bg-gray-50 dark:bg-gray-800; border-radius: 12px; overflow: hidden;
            @apply shadow-lg dark:shadow-2xl; transform-style: preserve-d;
            will-change: transform; transition: transform 0.3s ease-out, box-shadow 0.3s ease-out;
            position: relative;
        }
        .project-card:hover { @apply shadow-xl dark:shadow-sky-500/20; }
        .project-card .shine {
            position: absolute; top: 0; left: 0; right: 0; bottom: 0; border-radius: 12px;
            background: linear-gradient(rgba(255, 255, 255, 0.1) 0%, rgba(255, 255, 255, 0) 100%);
            opacity: 0; transition: opacity 0.3s ease; mix-blend-mode: overlay; pointer-events: none;
            z-index: 3;
        }
        .project-card:hover .shine { opacity: 1; }
        .project-card-content { position: relative; z-index: 2; }
        
        /* Command Palette Styling */
        #command-palette {
            position: fixed; top: 25%; left: 50%; transform: translate(-50%, -50px); z-index: 100;
            width: 90%; max-width: 500px;
            @apply bg-white dark:bg-gray-800 rounded-lg shadow-2xl border border-gray-300 dark:border-gray-700;
            overflow: hidden; transition: transform 0.3s ease-out, opacity 0.3s ease-out;
        }
        #command-palette.hidden { opacity: 0; transform: translate(-50%, -50px) scale(0.95); pointer-events: none; }
        #command-input {
            width: 100%; padding: 1rem; @apply bg-transparent text-lg text-gray-900 dark:text-gray-100;
            border-bottom: 1px solid; @apply border-gray-200 dark:border-gray-700;
        }
        #command-input:focus { outline: none; }
        .command-item {
            padding: 0.75rem 1rem; @apply flex items-center space-x-3 text-gray-700 dark:text-gray-300;
            cursor: pointer;
        }
        .command-item.selected { @apply bg-sky-100 dark:bg-sky-900; }
        .command-item-key { @apply ml-auto text-xs font-mono p-1 rounded bg-gray-200 dark:bg-gray-700; }
        
        /* NEW: Admin Modal Styling */
        #admin-modal {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            z-index: 200;
            @apply bg-black/50 backdrop-blur-sm;
            display: flex; align-items: center; justify-content: center;
            opacity: 0; transition: opacity 0.3s; pointer-events: none;
        }
        #admin-modal.visible { opacity: 1; pointer-events: all; }
        
        .admin-panel {
            width: 90%; max-width: 600px;
            @apply bg-white dark:bg-gray-800 rounded-lg shadow-2xl;
            max-height: 90vh; overflow-y: auto;
        }
        
        .admin-form-group { @apply mb-4; }
        .admin-label {
            display: block; @apply text-sm font-medium text-gray-700 dark:text-gray-300 mb-1;
        }
        .admin-input, .admin-textarea, .admin-file-input {
            width: 100%; padding: 0.5rem 0.75rem; @apply rounded-md border border-gray-300 dark:border-gray-600;
            @apply bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100;
        }
        .admin-file-input { @apply p-0 file:py-2 file:px-4 file:border-0 file:font-semibold file:mr-3 file:bg-sky-50 file:text-sky-600 dark:file:bg-sky-900 dark:file:text-sky-300; }
        .admin-textarea { min-height: 120px; }
        
        .admin-button {
            padding: 0.5rem 1rem; @apply rounded-md font-semibold text-white;
            @apply bg-sky-500 hover:bg-sky-600;
        }
        .admin-button-secondary {
            @apply bg-gray-600 hover:bg-gray-700;
        }
        .admin-button-danger {
            @apply bg-red-500 hover:bg-red-600;
        }
    </style>
</head>
<body class="antialiased">

    <!-- Container -->
    <div class="min-h-screen">
        
        <!-- Header & Navigation -->
        <header class="fixed top-0 left-0 right-0 z-50 backdrop-blur-md">
            <nav class="max-w-6xl mx-auto px-6 py-4 flex justify-between items-center
                        bg-white/80 dark:bg-gray-900/80
                        border-b border-gray-200 dark:border-gray-700">
                <a href="#" class="text-xl font-bold gradient-text data-hoverable">Ayaan Agarwal</a>
                
                <div class="hidden md:flex space-x-8">
                    <a href="#home" class="text-gray-600 dark:text-gray-300 hover:text-sky-500 dark:hover:text-sky-400 transition-colors">Home</a>
                    <a href="#projects" class="text-gray-600 dark:text-gray-300 hover:text-sky-500 dark:hover:text-sky-400 transition-colors">Projects</a>
                    <a href="#about" class="text-gray-600 dark:text-gray-300 hover:text-sky-500 dark:hover:text-sky-400 transition-colors">About</a>
                    <a href="#blog" class="text-gray-600 dark:text-gray-300 hover:text-sky-500 dark:hover:text-sky-400 transition-colors">Blog</a>
                </div>
                
                <a href="mailto:your-email@example.com" class="hidden md:block bg-sky-500 text-white px-4 py-2 rounded-lg font-medium hover:bg-sky-600 transition-colors">
                    Get in Touch
                </a>
                
                <button class="md:hidden text-gray-600 dark:text-gray-300 data-hoverable">
                    <i data-lucide="menu"></i>
                </button>
            </nav>
        </header>

        <!-- Main Content -->
        <main>
            <!-- Hero Section -->
            <section id="home" class="relative min-h-screen flex items-center justify-center text-center overflow-hidden">
                <canvas id="interactive-canvas"></canvas>
                <div class="hero-content pt-16 md:pt-0">
                    <h1 class="text-5xl md:text-7xl font-extrabold mb-6">
                        Hi, I'm <span class="gradient-text" id="typing-name"></span><span class="typing-cursor"></span>
                    </h1>
                    <p class="text-xl md:text-2xl text-gray-700 dark:text-gray-300 max-w-3xl mx-auto mb-10 scroll-animate slide-in-up" style="transition-delay: 100ms;">
                        A 10th-grade student at UWCSEA East Campus with a passion for
                        <br class="hidden md:block">
                        technology, programming, and engineering.
                    </p>
                    <div class="flex justify-center space-x-4 scroll-animate slide-in-up" style="transition-delay: 200ms;">
                        <a href="#projects" class="bg-sky-500 text-white px-6 py-3 rounded-lg font-semibold text-lg hover:bg-sky-600 transition-colors">
                            View My Projects
                        </a>
                        <a href="#about" class="bg-gray-700 text-gray-200 px-6 py-3 rounded-lg font-semibold text-lg hover:bg-gray-600 transition-colors">
                            About Me
                        </a>
                    </div>
                </div>
            </section>
            
            <!-- Sections container -->
            <div class="relative z-10 @apply bg-white dark:bg-gray-900;">
                
                <!-- Featured Projects Section -->
                <section id="projects" class="max-w-6xl mx-auto px-6 py-20">
                    <h2 class="text-4xl font-bold mb-12 text-center scroll-animate slide-in-up">Featured Projects</h2>
                    <!-- NEW: Content will be loaded from Supabase -->
                    <div id="projects-grid" class="grid grid-cols-1 md:grid-cols-2 gap-8">
                        <!-- Placeholder while loading -->
                        <p class="text-gray-500 dark:text-gray-400">Loading projects...</p>
                    </div>
                </section>

                <!-- About Me Teaser Section -->
                <section id="about" class="max-w-6xl mx-auto px-6 py-20 overflow-hidden">
                    <div class="bg-gray-100 dark:bg-gray-800 rounded-2xl p-12 md:flex items-center gap-12">
                        <div class="md:w-1/2 scroll-animate slide-in-left">
                            <h2 class="text-4xl font-bold mb-6">About Me</h2>
                            <p class="text-lg mb-4 text-gray-700 dark:text-gray-300">I'm Ayaan, a 10th-grade student at UWCSEA East Campus. From a young age, I've been fascinated by how things work, which led me to the world of technology and engineering.</p>
                            <p class="text-lg mb-8 text-gray-700 dark:text-gray-300">I love building, tinkering, and solving problems. This portfolio is where I'll document my journey, from simple scripts to complex engineering projects.</p>
                            <a href="#" class="bg-gray-700 text-gray-200 px-6 py-3 rounded-lg font-semibold hover:bg-gray-600 transition-colors">Read More About Me</a>
                        </div>
                        <div class="md:w-1/2 mt-10 md:mt-0 scroll-animate slide-in-right">
                            <img src="https://placehold.co/600x600/1F2937/E5E7EB?text=Ayaan+Agarwal" alt="Ayaan Agarwal" class="rounded-xl shadow-xl w-full">
                        </div>
                    </div>
                </section>
                
                <!-- Hobbies Section -->
                <section id="hobbies" class="max-w-6xl mx-auto px-6 py-20">
                    <h2 class="text-4xl font-bold mb-12 text-center scroll-animate slide-in-up">Hobbies & Passions</h2>
                    <!-- NEW: Content will be loaded from Supabase -->
                    <div id="hobbies-grid" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-8 text-center">
                         <p class="text-gray-500 dark:text-gray-400">Loading hobbies...</p>
                    </div>
                </section>
                
                <!-- Awards & NYAA Section -->
                <section id="awards" class="max-w-6xl mx-auto px-6 py-20">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                        <!-- Awards -->
                        <div class="scroll-animate slide-in-left">
                            <h2 class="text-3xl font-bold mb-6">Awards</h2>
                            <!-- NEW: Content will be loaded from Supabase -->
                            <ul id="awards-list" class="space-y-4">
                                <p class="text-gray-500 dark:text-gray-400">Loading awards...</p>
                            </ul>
                        </div>
                        
                        <!-- NYAA -->
                        <div class="scroll-animate slide-in-right">
                            <h2 class="text-3xl font-bold mb-6">NYAA</h2>
                            <!-- NEW: Content will be loaded from Supabase -->
                            <div id="nyaa-content" class="p-6 bg-gray-100 dark:bg-gray-800 rounded-lg">
                                <p class="text-gray-500 dark:text-gray-400">Loading NYAA info...</p>
                            </div>
                        </div>
                    </div>
                </section>
            </div>
        </main>
        
        <!-- Footer -->
        <footer class="max-w-6xl mx-auto px-6 py-12 text-center text-gray-500 relative z-10 @apply bg-white dark:bg-gray-900;">
            <p>&copy; 2025 Ayaan Agarwal. All rights reserved.</p>
            <p class="mt-2">Built with Vibe-Coding (and a little HTML, CSS, & JavaScript).</p>
            <a href="#" id="admin-login-button" class="text-xs text-gray-700 dark:text-gray-600 hover:text-sky-500">Admin</a>
        </footer>
    </div>
    
    <!-- Command Palette Modal -->
    <div id="command-palette" class="hidden">
        <input type="text" id="command-input" placeholder="Type a command or search..." autocomplete="off">
        <div id="command-list"></div>
    </div>

    <!-- NEW: Admin Panel Modal -->
    <div id="admin-modal" class="hidden">
        <!-- Login Form (Visible by default) -->
        <div id="login-form" class="admin-panel">
            <form class="p-6">
                <h2 class="text-2xl font-bold mb-4">Admin Login</h2>
                <p id="auth-error" class="text-red-500 text-sm mb-3 hidden"></p>
                <div class="admin-form-group">
                    <label for="email" class="admin-label">Email</label>
                    <input type="email" id="email" class="admin-input" required>
                </div>
                <div class="admin-form-group">
                    <label for="password" class="admin-label">Password</label>
                    <input type="password" id="password" class="admin-input" required>
                </div>
                <div class="flex justify-between items-center">
                    <button type="submit" id="login-button" class="admin-button">Login</button>
                    <!-- Hide signup initially, you can enable it to create your first account -->
                    <button type="submit" id="signup-button" class="admin-button admin-button-secondary">Sign Up</button>
                    <button type="button" id="admin-close-button" class="text-gray-500 hover:text-gray-700 dark:hover:text-gray-300">Close</button>
                </div>
            </form>
        </div>
        
        <!-- Admin Dashboard (Hidden by default) -->
        <div id="admin-dashboard" class_name="admin-panel hidden p-6">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-2xl font-bold">Admin Dashboard</h2>
                <button id="logout-button" class="admin-button admin-button-danger">Logout</button>
            </div>
            
            <!-- Forms for content -->
            <p class="text-green-500 text-sm mb-3 hidden" id="form-success-message"></p>
            
            <!-- Blog Post Form -->
            <form id="blog-form" class="mb-6 p-4 border dark:border-gray-700 rounded-lg">
                <h3 class="text-lg font-semibold mb-3">Add Blog Post</h3>
                <div class="admin-form-group"><label class="admin-label">Title</label><input type="text" id="blog-title" class="admin-input" required></div>
                <div class="admin-form-group"><label class="admin-label">Content</label><textarea id="blog-content" class="admin-textarea"></textarea></div>
                <div class="admin-form-group"><label class="admin-label">Image (for thumbnail)</label><input type="file" id="blog-image" class="admin-file-input" accept="image/*"></div>
                <div class="admin-form-group"><label class="admin-label">Video URL (YouTube/Vimeo)</label><input type="text" id="blog-video" class="admin-input"></div>
                <div class="admin-form-group"><label class="admin-label">Custom Code (JS/CSS)</label><textarea id="blog-code" class="admin-textarea" placeholder="<style>...</style> or <script>...</script>"></textarea></div>
                <button type="submit" class="admin-button">Save Blog Post</button>
            </form>
            
            <!-- Project Form -->
            <form id="project-form" class="mb-6 p-4 border dark:border-gray-700 rounded-lg">
                <h3 class="text-lg font-semibold mb-3">Add Project</h3>
                <div class="admin-form-group"><label class="admin-label">Title</label><input type="text" id="project-title" class="admin-input" required></div>
                <div class="admin-form-group"><label class="admin-label">Description</label><textarea id="project-desc" class="admin-textarea"></textarea></div>
                <div class="admin-form-group"><label class="admin-label">Image</label><input type="file" id="project-image" class="admin-file-input" accept="image/*" required></div>
                <div class="admin-form-group"><label class="admin-label">Project Link</label><input type="text" id="project-link" class="admin-input"></div>
                <button type="submit" class="admin-button">Save Project</button>
            </form>
            
            <!-- Simple forms for Hobbies & Awards -->
            <div class="grid grid-cols-2 gap-4">
                <form id="hobby-form" class="p-4 border dark:border-gray-700 rounded-lg">
                    <h3 class="text-lg font-semibold mb-3">Add Hobby</h3>
                    <div class="admin-form-group"><label class="admin-label">Name</label><input type="text" id="hobby-name" class="admin-input" required></div>
                    <button type="submit" class="admin-button">Save Hobby</button>
                </form>
                <form id="award-form" class="p-4 border dark:border-gray-700 rounded-lg">
                    <h3 class="text-lg font-semibold mb-3">Add Award</h3>
                    <div class="admin-form-group"><label class="admin-label">Title</label><input type="text" id="award-title" class="admin-input" required></div>
                    <div class="admin-form-group"><label class="admin-label">Category</label><input type="text" id="award-category" class="admin-input" placeholder="e.g., Swimming"></div>
                    <button type="submit" class="admin-button">Save Award</button>
                </form>
            </div>
            
        </div>
    </div>

    <!-- NEW: Supabase Client & Main JS -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        // --- Supabase Connection ---
        const SUPABASE_URL = 'https://usepeotquhanhqsnccat.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVzZXBlb3RxdWhhbmhxc25jY2F0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM3MTc3MzUsImV4cCI6MjA3OTI5MzczNX0.c_gMgAg9nFEuSd6hC6qKZ3aJBGcmk0VHdGlBDVYfpXk';
        const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        // --- Main App Logic ---
        document.addEventListener('DOMContentLoaded', (event) => {
            
            // --- Lucide Icons ---
            lucide.createIcons();

            // --- Load Content on Page Load ---
            loadAllContent();

            // --- Animations (Canvas, Typing, Scroll, 3D Card) ---
            // ... (All animation code from the previous version is unchanged) ...
            const canvas = document.getElementById('interactive-canvas'); const ctx = canvas.getContext('2d'); let particles = []; let mouse = { x: null, y: null, radius: 100 }; function resizeCanvas() { canvas.width = window.innerWidth; canvas.height = canvas.parentElement.offsetHeight; }
            window.addEventListener('resize', () => { resizeCanvas(); initParticles(); }); window.addEventListener('mousemove', (e) => { mouse.x = e.clientX; mouse.y = e.clientY; });
            class Particle { constructor(x, y) { this.x = x; this.y = y; this.baseX = this.x; this.baseY = this.y; this.size = 2; this.baseColor = 'rgba(56, 189, 248, 0.2)'; this.activeColor = 'rgba(56, 189, 248, 0.8)'; this.density = (Math.random() * 30) + 1; } draw() { ctx.beginPath(); ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2); let dx = mouse.x - this.x; let dy = mouse.y - this.y; let distance = Math.sqrt(dx * dx + dy * dy); if (distance < mouse.radius) { ctx.fillStyle = this.activeColor; } else { ctx.fillStyle = this.baseColor; } ctx.fill(); } update() { let dx = mouse.x - this.x; let dy = mouse.y - this.y; let distance = Math.sqrt(dx * dx + dy * dy); let forceDirectionX = dx / distance; let forceDirectionY = dy / distance; let maxDistance = mouse.radius; let force = (maxDistance - distance) / maxDistance; let directionX = (forceDirectionX * force * this.density); let directionY = (forceDirectionY * force * this.density); if (distance < mouse.radius) { this.x -= directionX; this.y -= directionY; } else { if (this.x !== this.baseX) { let dx = this.x - this.baseX; this.x -= dx / 10; } if (this.y !== this.baseY) { let dy = this.y - this.baseY; this.y -= dy / 10; } } this.draw(); } }
            function initParticles() { particles = []; let spacing = 30; let numCols = Math.ceil(canvas.width / spacing); let numRows = Math.ceil(canvas.height / spacing); for (let i = 0; i < numCols; i++) { for (let j = 0; j < numRows; j++) { particles.push(new Particle(i * spacing, j * spacing)); } } }
            function animateParticles() { ctx.clearRect(0, 0, canvas.width, canvas.height); for (let i = 0; i < particles.length; i++) { particles[i].update(); } requestAnimationFrame(animateParticles); }
            resizeCanvas(); initParticles(); animateParticles();
            const typingElement = document.getElementById('typing-name'); const textToType = "Ayaan Agarwal"; let typeIndex = 0; function typeEffect() { if (typeIndex < textToType.length) { typingElement.textContent += textToType.charAt(typeIndex); typeIndex++; setTimeout(typeEffect, 120); } else { const cursor = document.querySelector('.typing-cursor'); if (cursor) cursor.style.animation = 'none'; } }
            setTimeout(typeEffect, 500);
            const elementsToAnimate = document.querySelectorAll('.scroll-animate'); const scrollObserver = new IntersectionObserver((entries) => { entries.forEach(entry => { if (entry.isIntersecting) { entry.target.classList.add('is-visible'); scrollObserver.unobserve(entry.target); } }); }, { rootMargin: '0px', threshold: 0.1 });
            elementsToAnimate.forEach(el => { scrollObserver.observe(el); });
            const cards = document.querySelectorAll('.project-card'); cards.forEach(card => { const shine = card.querySelector('.shine'); card.addEventListener('mousemove', (e) => { const rect = card.getBoundingClientRect(); const x = e.clientX - rect.left; const y = e.clientY - rect.top; const midX = rect.width / 2; const midY = rect.height / 2; const maxRotate = 8; const rotateY = (x - midX) / midX * maxRotate; const rotateX = (midY - y) / midY * maxRotate; card.style.transform = `perspective(1000px) rotateX(${rotateX}deg) rotateY(${rotateY}deg) scale(1.05)`; if (shine) { const glareX = (x / rect.width) * 100; const glareY = (y / rect.height) * 100; shine.style.background = `radial-gradient(circle at ${glareX}% ${glareY}%, rgba(255, 255, 255, 0.2) 0%, rgba(255, 255, 255, 0) 50%)`; } }); card.addEventListener('mouseleave', () => { card.style.transform = 'perspective(1000px) rotateX(0) rotateY(0) scale(1)'; if (shine) { shine.style.background = `linear-gradient(rgba(255, 255, 255, 0.1) 0%, rgba(255, 255, 255, 0) 100%)`; } }); });

            // --- Command Palette Logic ---
            // ... (Command palette JS unchanged) ...
            const palette = document.getElementById('command-palette'); const input = document.getElementById('command-input'); const list = document.getElementById('command-list'); let selectedIndex = 0;
            const allCommands = [ { id: 'nav:home', name: 'Navigate: Home', icon: 'home', action: () => scrollTo('#home') }, { id: 'nav:projects', name: 'Navigate: Projects', icon: 'folder-kanban', action: () => scrollTo('#projects') }, { id: 'nav:about', name: 'Navigate: About', icon: 'user', action: () => scrollTo('#about') }, { id: 'nav:hobbies', name: 'Navigate: Hobbies', icon: 'smile', action: () => scrollTo('#hobbies') }, { id: 'nav:awards', name: 'Navigate: Awards', icon: 'award', action: () => scrollTo('#awards') }, { id: 'theme:toggle', name: 'Theme: Toggle Light/Dark', icon: 'sun-moon', action: () => toggleTheme() }, { id: 'secret:matrix', name: 'Secret: ???', icon: 'terminal', action: () => alert('Matrix effect coming soon!') }, ];
            function openPalette() { palette.classList.remove('hidden'); input.focus(); renderCommands(''); } function closePalette() { palette.classList.add('hidden'); }
            function renderCommands(filter) { list.innerHTML = ''; const filtered = allCommands.filter(cmd => cmd.name.toLowerCase().includes(filter.toLowerCase())); filtered.forEach((cmd, index) => { const item = document.createElement('div'); item.className = 'command-item' + (index === selectedIndex ? ' selected' : ''); item.innerHTML = `<i data-lucide="${cmd.icon}" class="w-4 h-4"></i><span>${cmd.name}</span><span class="command-item-key">${cmd.id.split(':')[0]}</span>`; item.addEventListener('click', () => { cmd.action(); closePalette(); }); list.appendChild(item); }); lucide.createIcons(); }
            function scrollTo(selector) { const element = document.querySelector(selector); if (element) { element.scrollIntoView({ behavior: 'smooth' }); } }
            function toggleTheme() { document.documentElement.classList.toggle('dark'); }
            window.addEventListener('keydown', (e) => { if ((e.metaKey || e.ctrlKey) && e.key === 'k') { e.preventDefault(); palette.classList.contains('hidden') ? openPalette() : closePalette(); } if (e.key === 'Escape' && !palette.classList.contains('hidden')) { closePalette(); } if (!palette.classList.contains('hidden')) { if (e.key === 'ArrowDown') { e.preventDefault(); selectedIndex = (selectedIndex + 1) % list.children.length; renderCommands(input.value); } if (e.key === 'ArrowUp') { e.preventDefault(); selectedIndex = (selectedIndex - 1 + list.children.length) % list.children.length; renderCommands(input.value); } if (e.key === 'Enter') { e.preventDefault(); const selectedCommand = allCommands.filter(cmd => cmd.name.toLowerCase().includes(input.value.toLowerCase()))[selectedIndex]; if (selectedCommand) { selectedCommand.action(); closePalette(); } } } });
            input.addEventListener('input', () => { selectedIndex = 0; renderCommands(input.value); });
            
            
            // --- NEW: Admin Panel & Supabase Logic ---
            
            // Admin Modal Elements
            const adminModal = document.getElementById('admin-modal');
            const adminLoginButton = document.getElementById('admin-login-button');
            const adminCloseButton = document.getElementById('admin-close-button');
            const loginForm = document.getElementById('login-form');
            const adminDashboard = document.getElementById('admin-dashboard');
            
            // Auth Form Elements
            const signupButton = document.getElementById('signup-button');
            const loginButton = document.getElementById('login-button');
            const logoutButton = document.getElementById('logout-button');
            const emailInput = document.getElementById('email');
            const passwordInput = document.getElementById('password');
            const authError = document.getElementById('auth-error');
            const formSuccess = document.getElementById('form-success-message');

            // --- Core Auth Functions ---
            
            // Open/Close Admin Modal
            adminLoginButton.addEventListener('click', (e) => {
                e.preventDefault();
                adminModal.classList.remove('hidden');
                adminModal.classList.add('visible');
            });
            adminCloseButton.addEventListener('click', () => {
                adminModal.classList.add('hidden');
                adminModal.classList.remove('visible');
            });
            
            // Sign Up
            signupButton.addEventListener('click', async (e) => {
                e.preventDefault();
                authError.classList.add('hidden');
                const { user, error } = await supabase.auth.signUp({
                    email: emailInput.value,
                    password: passwordInput.value,
                });
                if (error) {
                    authError.textContent = error.message;
                    authError.classList.remove('hidden');
                } else {
                    authError.textContent = 'Success! Please check your email to verify your account.';
                    authError.classList.remove('hidden');
                }
            });

            // Login
            loginButton.addEventListener('click', async (e) => {
                e.preventDefault();
                authError.classList.add('hidden');
                const { data, error } = await supabase.auth.signInWithPassword({
                    email: emailInput.value,
                    password: passwordInput.value,
                });
                if (error) {
                    authError.textContent = error.message;
                    authError.classList.remove('hidden');
                } else {
                    // User is logged in, session is handled by Supabase
                }
            });
            
            // Logout
            logoutButton.addEventListener('click', async () => {
                await supabase.auth.signOut();
            });

            // Check auth state
            supabase.auth.onAuthStateChange((event, session) => {
                if (session) {
                    // User is logged in
                    loginForm.classList.add('hidden');
                    adminDashboard.classList.remove('hidden');
                } else {
                    // User is logged out
                    loginForm.classList.remove('hidden');
                    adminDashboard.classList.add('hidden');
                }
            });

            // --- Helper: File Upload ---
            async function uploadFile(file) {
                if (!file) return null;
                
                const fileName = `${Date.now()}-${file.name}`;
                const { data, error } = await supabase.storage
                    .from('public-files') // This MUST match the bucket name you created
                    .upload(fileName, file);
                
                if (error) {
                    console.error('Error uploading file:', error);
                    return null;
                }
                
                // Get the public URL
                const { data: publicURLData } = supabase.storage
                    .from('public-files')
                    .getPublicUrl(fileName);
                
                return publicURLData.publicUrl;
            }

            // --- Helper: Show Success Message ---
            function showSuccess(message) {
                formSuccess.textContent = message;
                formSuccess.classList.remove('hidden');
                setTimeout(() => formSuccess.classList.add('hidden'), 3000);
            }

            // --- Admin Form Handlers ---
            
            // Blog Form
            document.getElementById('blog-form').addEventListener('submit', async (e) => {
                e.preventDefault();
                const file = document.getElementById('blog-image').files[0];
                const image_url = await uploadFile(file);
                
                const { error } = await supabase.from('blogs').insert({
                    title: document.getElementById('blog-title').value,
                    content: document.getElementById('blog-content').value,
                    image_url: image_url,
                    video_url: document.getElementById('blog-video').value,
                    custom_code: document.getElementById('blog-code').value,
                });
                
                if (error) { alert(error.message); }
                else { showSuccess('Blog post saved!'); e.target.reset(); }
            });

            // Project Form
            document.getElementById('project-form').addEventListener('submit', async (e) => {
                e.preventDefault();
                const file = document.getElementById('project-image').files[0];
                if (!file) {
                    alert('Project image is required.');
                    return;
                }
                const image_url = await uploadFile(file);
                
                const { error } = await supabase.from('projects').insert({
                    title: document.getElementById('project-title').value,
                    description: document.getElementById('project-desc').value,
                    image_url: image_url,
                    project_link: document.getElementById('project-link').value,
                });
                
                if (error) { alert(error.message); }
                else { showSuccess('Project saved!'); e.target.reset(); loadProjects(); } // Reload projects
            });

            // Hobby Form
            document.getElementById('hobby-form').addEventListener('submit', async (e) => {
                e.preventDefault();
                const { error } = await supabase.from('hobbies').insert({
                    name: document.getElementById('hobby-name').value
                });
                if (error) { alert(error.message); }
                else { showSuccess('Hobby saved!'); e.target.reset(); loadHobbies(); } // Reload hobbies
            });

            // Award Form
            document.getElementById('award-form').addEventListener('submit', async (e) => {
                e.preventDefault();
                const { error } = await supabase.from('awards').insert({
                    title: document.getElementById('award-title').value,
                    category: document.getElementById('award-category').value
                });
                if (error) { alert(error.message); }
                else { showSuccess('Award saved!'); e.target.reset(); loadAwards(); } // Reload awards
            });


            // --- NEW: Functions to Load Content from Supabase ---
            
            async function loadAllContent() {
                loadProjects();
                loadHobbies();
                loadAwards();
                loadNyaa(); // You can make an NYAA form next!
            }
            
            async function loadProjects() {
                const grid = document.getElementById('projects-grid');
                const { data, error } = await supabase.from('projects').select('*');
                if (error) { grid.innerHTML = `<p class="text-red-500">Error loading projects.</p>`; return; }
                
                if (data.length === 0) {
                    grid.innerHTML = `<p class="text-gray-500 dark:text-gray-400">No projects added yet. Click 'Admin' to add one!</p>`; return;
                }
                
                grid.innerHTML = data.map((project, index) => `
                    <div class="scroll-animate slide-in-up" style="transition-delay: ${index * 150}ms;">
                        <div class="project-card h-full flex flex-col" data-hoverable>
                            <div class="shine"></div>
                            <div class="project-card-content">
                                <img src="${project.image_url}" alt="${project.title}" class="w-full h-64 object-cover">
                                <div class="p-8 flex-grow">
                                    <h3 class="text-2xl font-bold mb-3">${project.title}</h3>
                                    <p class="text-gray-500 dark:text-gray-400 mb-4">${project.description}</p>
                                </div>
                                <div class="p-8 pt-0">
                                    <a href="${project.project_link || '#'}" target="_blank" class="text-sky-500 dark:text-sky-400 font-medium hover:text-sky-600 dark:hover:text-sky-300 transition-colors">
                                        View Details &rarr;
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                `).join('');
                // We need to re-run the 3D card logic for these new elements
                document.querySelectorAll('.project-card').forEach(card => addCardHover(card));
            }

            async function loadHobbies() {
                const grid = document.getElementById('hobbies-grid');
                const { data, error } = await supabase.from('hobbies').select('*');
                if (error) { grid.innerHTML = `<p class="text-red-500">Error loading hobbies.</p>`; return; }
                if (data.length === 0) { grid.innerHTML = `<p class="text-gray-500 dark:text-gray-400">No hobbies added yet.</p>`; return; }
                
                grid.innerHTML = data.map((hobby, index) => `
                    <div class="scroll-animate slide-in-up" style="transition-delay: ${index * 100}ms;">
                        <div class="p-6 bg-gray-100 dark:bg-gray-800 rounded-xl">
                            <p>${hobby.name}</p>
                        </div>
                    </div>
                `).join('');
            }
            
            async function loadAwards() {
                const list = document.getElementById('awards-list');
                const { data, error } = await supabase.from('awards').select('*');
                if (error) { list.innerHTML = `<p class="text-red-500">Error loading awards.</p>`; return; }
                if (data.length === 0) { list.innerHTML = `<p class="text-gray-500 dark:text-gray-400">No awards added yet.</p>`; return; }
                
                list.innerHTML = data.map(award => `
                    <li class="p-4 bg-gray-100 dark:bg-gray-800 rounded-lg">
                        <strong>${award.title}</strong>
                        <span class="text-sm text-gray-500 dark:text-gray-400 ml-2">(${award.category})</span>
                    </li>
                `).join('');
            }

            async function loadNyaa() {
                const el = document.getElementById('nyaa-content');
                const { data, error } = await supabase.from('nyaa').select('*').limit(1); // Get first entry
                if (error) { el.innerHTML = `<p class="text-red-500">Error loading NYAA info.</p>`; return; }
                if (!data || data.length === 0) { el.innerHTML = `<p class="text-gray-500 dark:text-gray-400">NYAA info not added yet.</p>`; return; }
                
                el.innerHTML = `
                    <h3 class="text-xl font-bold mb-3">${data[0].title}</h3>
                    <p class="text-gray-700 dark:text-gray-300">${data[0].description}</p>
                    ${data[0].image_url ? `<img src="${data[0].image_url}" alt="NYAA" class="rounded-lg w-full mt-4">` : ''}
                `;
            }
            
            // Helper to re-add 3D card logic to new elements
            function addCardHover(card) {
                const shine = card.querySelector('.shine');
                card.addEventListener('mousemove', (e) => {
                    const rect = card.getBoundingClientRect(); const x = e.clientX - rect.left; const y = e.clientY - rect.top; const midX = rect.width / 2; const midY = rect.height / 2; const maxRotate = 8; const rotateY = (x - midX) / midX * maxRotate; const rotateX = (midY - y) / midY * maxRotate;
                    card.style.transform = `perspective(1000px) rotateX(${rotateX}deg) rotateY(${rotateY}deg) scale(1.05)`;
                    if (shine) { const glareX = (x / rect.width) * 100; const glareY = (y / rect.height) * 100; shine.style.background = `radial-gradient(circle at ${glareX}% ${glareY}%, rgba(255, 255, 255, 0.2) 0%, rgba(255, 255, 255, 0) 50%)`; }
                });
                card.addEventListener('mouseleave', () => {
                    card.style.transform = 'perspective(1000px) rotateX(0) rotateY(0) scale(1)';
                    if (shine) { shine.style.background = `linear-gradient(rgba(255, 255, 255, 0.1) 0%, rgba(255, 255, 255, 0) 100%)`; }
                });
            }

        });
    </script>
</body>
</html>
